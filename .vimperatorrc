" set runtime path {{{
" note: ~/.vimperatorrc (linux/Mac) or ~/vimperatorrc are always used for info
"       even when runtimepath is set as below
set runtimepath=~/My\ Dropbox/08_Settings/vimpr/vimperator,~/Dropbox/08_Settings/vimpr/vimperator

"js<<EOM
"// for path_to/info/default
"liberator.modules.storage.infoPath.initWithPath(File.expandPath("~/vimperator"));
"EOM

" }}}

" basic settings {{{
"set guioptions=mTBrb
set titlestring=Firefox
set focuscontent
"set defsearch=googleall
set defsearch=google
set! ui.caretWidth=2
set gui+=noaddons
set suggestengines=google

" disable access key
"set! ui.key.contentAcess=0
"set! ui.key.chromeAcess=0

" always ime off for command line mode
style -name commandline-ime chrome://* #liberator-commandline-command input {ime-mode: inactive;}

" start page
set! browser.startup.page=1

" complete
" l: location bar completions
" b: bookmarks
" S: suggestion of search engines
" s: search engine names
" f: local files
set complete=lbSsf

" next/previous patterns (by ]]/[[)
set nextpattern=^¥次,^¥続き,¥bnext,^>$,^(>>¥|??)$,^(>¥|??),(>¥|??),¥bmore¥b$
set previouspattern=^¥前,^¥戻,¥bprev|previous¥b,^<$,^(<<¥|??)$,^(<¥|??),(<¥|??)$

" for hint
set hintchars=ifjklasdweuocvbnm

" style
"style chrome://* #statusbar-display:not([type="overLink"]) {display: none !important;}
"style chrome://* #statusbar-display {display: none;}
style chrome://* .statuspanel-label {display: none;}

" user_pref
set! extensions.adblockplus.sidebar_key="Accel Shift Q"

" }}}

" qmarks {{{
" google mail/reader/task/calendar
silent qmark m https://mail.google.com
silent qmark r http://www.google.co.jp/reader/view/#stream/
silent qmark t https://mail.google.com/tasks/canvas
silent qmark c https://www.google.com/calendar
" google translator en/ja/language tool
silent qmark e javascript:var%20t=((window.getSelection&&window.getSelection())%7C%7C(document.getSelection&&document.getSelection())%7C%7C(document.selection&&document.selection.createRange&&document.selection.createRange().text));var%20e=(document.charset%7C%7Cdocument.characterSet);if(t!='')%7Blocation.href='http://translate.google.com/translate_t?text='+t+'&hl=ja&langpair=auto%7Cen&tbb=1&ie='+e;%7Delse%7Blocation.href='http://translate.google.com/translate?u='+escape(location.href)+'&hl=ja&langpair=auto%7Cen&tbb=1&ie='+e;%7D;
silent qmark j javascript:var%20t=((window.getSelection&&window.getSelection())%7C%7C(document.getSelection&&document.getSelection())%7C%7C(document.selection&&document.selection.createRange&&document.selection.createRange().text));var%20e=(document.charset%7C%7Cdocument.characterSet);if(t!='')%7Blocation.href='http://translate.google.com/?text='+t+'&hl=ja&langpair=auto%7Cja&tbb=1&ie='+e;%7Delse%7Blocation.href='http://translate.google.com/translate?u='+encodeURIComponent(location.href)+'&hl=ja&langpair=auto%7Cja&tbb=1&ie='+e;%7D;
silent qmark l http://www.google.com/language_tools
" bit.ty
silent qmark b javascript:(function()%20%7B%20var%20s%20=%20document.createElement(%22script%22);%20s.setAttribute(%22id%22,%20%22bitmark_js%22);%20s.setAttribute(%22type%22,%20%22text/javascript%22);%20s.setAttribute(%22src%22,%20%22//bitly.com/a/bitmarklet.js%22);%20(top.document.body%20%7C%7C%20top.document.getElementsByTagName(%22head%22)[0]).appendChild(s);%20%7D)();
silent qmark f http://cloud.feedly.com/#latest
silent qmark p http://getpocket.com/a/queue/
" pocket
" silent qmark q ... " in vimperator.local
" nnoremap p goq
silent qmark g http://github.com/rcmdnk

" }}}

" KeyMapping{{{

"-----------------------------------------------------------------
" mapname	normal	visual	 insert	commandline
" noremap	o	o	 x	x
" noremap!	x	x	 o	o
" nnoremap	o	x	 x	x
" vnoremap	x	o	 x	x
" inoremap	x	x	 o	x
" cnoremap	x	x	 x	o
"-----------------------------------------------------------------

" normal mode
"nnoremap <C-v> <C-v><C-v>
"nnoremap <C-c> <C-v><C-c>
nnoremap <C-h> h
nnoremap <C-j> j
nnoremap <C-k> k
nnoremap <C-l> l
nnoremap <C-w> <Nop>
"nnoremap <A-Down> :set guioptions=mTBrb<CR>
"nnoremap <A-Up> :set guioptions=<CR>
"nnoremap <BS> <A-Left>
"nnoremap b <Nop>
"nnoremap s ;a
"nnoremap b a
nnoremap b :open about:mybookmarks<cr>
nnoremap <C-g> YP
nnoremap s ;s
nnoremap <M-b> <M-d>
nnoremap <A-b> i<C-d>
nnoremap <C-m> <CR>
"nnoremap <C-j> <NL>
nnoremap <C-[> <Esc>
nnoremap Q :qmarks<CR>
nnoremap ; :
nnoremap : ;

"js<<EOM
"  if (liberator.has("MacUnix")) {
"    liberator.execute("nnoremap yo y:open <M-v>");
"  } else {
"    liberator.execute("nnoremap yo y:open <C-v>");
"  }
"EOM

" other than normal mode
nnoremap! <C-[> <Esc>

" commandline mode
cnoremap <C-p> <Up>
cnoremap <C-n> <Down>
cnoremap <C-b> <Left>
cnoremap <C-f> <Right>
cnoremap <C-j> <Nop>
cnoremap <C-o> <Nop>
"cnoremap <C-p> <Nop>
"cnoremap <C-v> <C-v><C-v>
"cnoremap <C-c> <C-v><C-c>
"cnoremap <C-x> <C-v><C-x>

" input mode
inoremap <C-f> <Right>
inoremap <C-b> <Left>
inoremap <C-n> <Down>
inoremap <C-p> <Up>
inoremap <C-j> <Nop>
inoremap <C-o> <Nop>
inoremap <C-p> <Nop>
"inoremap <C-v> <C-v><C-v>
"inoremap <C-c> <C-v><C-c>
"inoremap <C-x> <C-v><C-x>
"inoremap <C-e> <C-i>
"inoremap <M-i> <C-i>
"inoremap <C-i> <Nop>

" caret mode
vnoremap <C-g> y<Esc><Esc>P

" }}}

" color scheme {{{

hi Hint font-family: monospace; font-size: 15px; font-weight: normal; color: lightyellow; background-color: black; border-color: ButtonShadow; border-width: 0px; border-style: solid; padding: 0px 5px 0px 5px; text-transform: uppercase;
hi HintElem background-color: LightSkyBlue; color: black;
hi HintActive background-color: DeepSkyBlue; color: white;

"" shadow, please comment out if it doesn't work smoothly
hi -append Hint background-color: rgba(28, 28, 28, 0.7); border: 1px solid #1c1c1c; -moz-border-radius: 4px; -moz-box-shadow: 0px 0px 1px black; text-shadow: 1px 1px 2px black;
hi -append HintElem text-decoration: none; -moz-border-radius: 4px; -moz-box-shadow: 0 0 2px #0c0c0c;
hi -append HintActive text-decoration: none; -moz-border-radius: 4px; -moz-box-shadow: 0 0 2px #0c0c0c;

"hi StatusLine color: CornflowerBlue; background: #000; font-weight: normal; font-size: 12pt;
"hi StatusLineBroken color: black; background: #ffa0a0; font-weight: normal; font-size: 12pt;
"hi StatusLineExtended color: black; background: #a0ffa0; font-weight: normal; font-size: 12pt;
"hi StatusLineSecure color: black; background: #a0a0ff; font-weight: normal; font-size: 12pt;

hi Normal color: LightYellow; background: Black; font-size: 12pt; opacity: 0.7;
hi CmdLine color: LightYellow; background: Black; font-size: 14pt;
hi InfoMsg color: LightYellow; background: Black; font-size: 12pt;
hi ModeMsg color: LightYellow; background: Black; font-size: 12pt;
hi MoreMsg color: LimeGreen; background: Black;
hi LineNr color: DeepPink; background: Black; font-size: 12pt;
hi Question color: Yellow; background: Black; font-size: 12pt;
hi WarningMsg color: DeepPink; background: Black; font-size: 12pt;
hi ErrorMsg color: white; background: red; font-size: 12pt;
hi NonText background: #000;
hi Null color: CornflowerBlue;
hi Tag color: CornflowerBlue;
hi Number color: CornflowerBlue;

hi CompTitle background: DarkBlue;
hi CompTitle>* color: white; border-bottom: 1px solid #3c3c3f; padding: 1px 0.5ex; text-shadow: 1px 1px 0px #0c0c0c;
hi CompItem[selected] color: cyan; background: #333;
hi CompDesc color: Pink;

hi Title color: white;
hi Indicator color: DodgerBlue;
hi String color: Orchid;
hi Number color: Orchid;
hi Object color: Khaki;
hi Function color: SkyBlue;
hi URL color: LightGreen;
" }}}

" multi_requester.js {{{
javascript <<EOM
liberator.globalVariables.multi_requester_siteinfo = [
    {
        name:        'lo',                             // required
        description: 'local',                          // required
        url:         'http://localhost/index.html?%s', // required, %s <-- replace string
        resultXpath: '//*',                            // optional(default all)
        encode:      'SHIFT-JIS',                      // optional(default UTF-8)
        ignoreTags:  'img',                            // optional(default script), syntax tag1,tag2,……
    },

    {
        name:        'gf',
        description: 'google dictionary (French -> English)',
        url:         'http://www.google.com/dictionary?aq=f&langpair=fr|en&q=%s&hl=ja',
        xpath:       '//div[@class="dct-srch-rslt"]'
    },

    {
        name:        'ge',
        description: 'google dictionary (English)',
        url:         'http://www.google.com/dictionary?aq=f&langpair=en|en&q=%s&hl=ja',
        xpath:       '//div[@class="dct-srch-rslt"]'
    },


    {
        name:        'gmap',
        description: 'google map',
        url:         'http://maps.google.co.jp/maps?hl=ja&tab=wl&q=%s',
        srcEncode:   'EUC-JP',
        urlEncode:   'UTF-8',
        xpath:       'id("map")'
    },
];
liberator.globalVariables.multi_requester_mappings = [
    [',ml', 'lo'],          // <-- :mr lo
    [',ma', 'alc',,"args"], // <-- :mr alc
    [',mg', 'goo', '!'],    // <-- :mr! goo
    ['a', 'alc'],           // == :mr alc
    [',a', 'alc'],           // == :mr alc
    ['ma', 'alc', '!'],     // == :mr! alc
    [',f', 'gf'],           // == :mr gf
    ['gf', 'gf'],           // == :mr gf
    ['mgf', 'gf', '!'],     // == :mr! gf
    [',e', 'ge'],           // == :mr ge
    ['ge', 'ge'],           // == :mr ge
    ['mge', 'ge', '!'],     // == :mr! ge
    ['gm', 'gmap', '!'],
    ['mgm', 'gmap'],
];
EOM


js <<EOM

liberator.registerObserver("enter", function() {
  // for auto_word_select.js
  mappings.addUserMap(
    [modes.AUTO_WORD_SELECT],
    ["a"],
    "Translate selected word by multi_requester.js.",
    function() {
      // FIXME:
      // A present mode is preserved in the stack beforehand by the push() method
      // because it doesn't return to AUTO_WORD_SELECT mode before that when
      // returning from the OUTPUT_MULTILINE mode.
      modes.push(modes.AUTO_WORD_SELECT, null, true);

      var selText = content.getSelection().toString();
      var pattern = /[a-zA-Z]+/;
      selText = pattern.test(selText) ? pattern.exec(selText) : selText;
      events.feedkeys(":mr alc " + selText + "<CR>", true, true);
    }
  );
});
EOM
" }}}

" caret hint {{{
js <<EOM
mappings.addUserMap(
  [modes.HINTS,modes.CARET],
  ["<C-n>"],
  "non",
  function() {
  }
);
EOM
js <<EOM
mappings.addUserMap(
  [modes.QUICK_HINTS,modes.CARET],
  ["<C-p>"],
  "non",
  function() {
  }
);
EOM
js <<EOM
mappings.addUserMap(
  [modes.QUICK_HINTS,modes.CARET],
  ["<C-f>"],
  "non",
  function() {
  }
);
EOM
" }}}

"copy.js {{{
javascript <<EOM
(function () {
  liberator.globalVariables.copy_templates = [
    { label: 'url', value: '%URL%', map:',u' },
    { label: 'anchor', value: '<a href="%URL%">%TITLE%</a>', map:',y' },
    { label: 'markdown', value: '[%TITLE%](%URL%)', map:',i' },
    { label: 'blockquote', value: '{% blockquote %TTITLE% %URL% %}%SEL%{% endblockquote %}', map:',bq' },

    { label: 'ai',   value: 'amazon image.',
      custom: function() {
        var id = "rcmdnk0c-22";
        var x = "200";
        if(content.document.getElementById('ASIN')){
          var asin = content.document.getElementById('ASIN').value;
        }else{
          var aa = content.document.querySelector('link[rel="canonical"]').href.split("/");
          var asin = aa[aa.length-1];
        }
        var l = 'http://www.amazon.co.jp/o/ASIN/'+asin+'/'+id;
        if(content.document.getElementById('prodImage')){
          var s = content.document.getElementById('prodImage').getAttribute('src');
        }else if(content.document.getElementById('main-image')){
          var s = content.document.getElementById('main-image').getAttribute('src');
        }else{
          var s = content.document.getElementById('landingImage').getAttribute('src');
        }
        var p = s.replace(/http:.*\/I\/([^\.]+).*$/,'$1');
        var a = s.replace(/(http:.*com).*/,'$1/images/I/');
        var i = a+p+'._SS'+x+'_.jpg';
        var t = content.document.getElementById('btAsinTitle').innerHTML;
        var alt = t.split("<")[0];
        var u = '<a href="'+l+'/" rel="nofollow" target="_blank">';
        return '<div class="amazon-img">'+u+'<img src="'+i+'" alt="'+alt+'"/></a></div>';
      }, map:',ai'
    },
    { label: 'amazon',   value: 'amazon full link and image.',
      custom: function() {
        var id = "rcmdnk0c-22";
        var x = "200";
        if(content.document.getElementById('ASIN')){
          var asin = content.document.getElementById('ASIN').value;
        }else{
          var aa = content.document.querySelector('link[rel="canonical"]').href.split("/");
          var asin = aa[aa.length-1];
        }
        var l = 'http://www.amazon.co.jp/o/ASIN/'+asin+'/'+id;
        if(content.document.getElementById('prodImage')){ 
          var s = content.document.getElementById('prodImage').getAttribute('src');
        }else if(content.content.document.getElementById('main-image')){
          var s = content.document.getElementById('main-image').getAttribute('src');
        }else{
          var s = content.document.getElementById('landingImage').getAttribute('src');
        }
        var p = s.replace(/http:.*\/I\/([^\.]+).*$/,'$1');
        var a = s.replace(/(http:.*com).*/,'$1/images/I/');
        var i = a+p+'._SS'+x+'_.jpg';
        var t = content.document.getElementById('btAsinTitle').innerHTML;
        var alt = t.split("<")[0];
        var u = '<a href="'+l+'/" rel="nofollow" target="_blank">';
        return '<div class="amazon-box"><div class="amazon-img">'+u+'<img src="'+i+'" alt="'+alt+'"/></a></div><div class="amazon-txt">'+u+t+'<br><br>Amazonで詳しく見る</a></div></div>';
      }, map:',am'
    },
  ];
})();
EOM
" }}}

" dont-kill-me-my-lovely-input.js {{{
" https://gist.github.com/anekos/2944628
js <<EOM
mappings.addUserMap(
  [modes.COMMAND_LINE],
  ['<Esc>'],
  'I wish to escape to the blue sky.',
  (function () {
    if (this._history && this._history.save)
      this._history.save();
    events.onEscape();
  }).bind(commandline),
  {}
);
EOM
" }}}

" Ignorekeys {{{
ignorekeys add mail\\.google\\.com -except :,t,d,<C-n>,<C-p>,<C-o>,<C-i>
" }}}

"" settings for each environment {{{
""set editor="C:/Program\\\ Files/vim/gvim.exe" " Done with Addons
"set editor="gvim.exe"
"js<<EOM
"  if (liberator.has("MacUnix")) {
"    //liberator.execute("set editor='/Applications/MacVim.app/Contents/MacOS/mvim -f'");
"    liberator.execute("set editor='/Applications/MacVim.app/Contents/MacOS/MacVim -f'");
"  //} else if (liberator.has("Win32") || liberator.has("Win64")) {
"    //liberator.execute('set editor=C:/Program Files/vim/gvim.exe --remote-tab-silent');
"  //}else if(liberator.has("Unix")){
"  }
"EOM
"
" local settings
source! ~/My\ Dropbox/08_Settings/vimpr/vimperatorrc.local
source! ~/Dropbox/08_Settings/vimpr/vimperatorrc.local
"" }}}

"echo ".vimperatorrc sourced"
